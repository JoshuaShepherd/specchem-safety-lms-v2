# Check-in: API Infrastructure Health Check

## Backend API System Assessment

**Required Context Files:**
- `apps/crm/src/app/api/` - All API route implementations
- `apps/crm/src/lib/auth/` - Authentication system
- `apps/crm/src/lib/middleware/` - API middleware
- `apps/crm/src/lib/queries/` - Query modules
- `apps/crm/src/lib/mappers/` - Data mappers
- `packages/contracts/src/index.ts` - API contracts and types
- `apps/crm/src/lib/supabase/` - Supabase configuration
- `tests/api/` - API test files (if exist)

**Cursor Prompt:**

```
Perform a comprehensive health check of our Safety Training API infrastructure and backend systems:

1. **Authentication System Validation:**
   - Test Supabase Auth integration and token handling
   - Verify role-based access control is working correctly
   - Check plant-based access restrictions
   - Test session management and token refresh
   - Validate auth bypass toggle (dev only) with proper warnings
   - Test user registration, login, and password reset flows

2. **API Route Functionality:**
   - Test all CRUD endpoints for each entity (plants, courses, enrollments, progress, etc.)
   - Verify ingress validation (request parsing with Zod) on all routes
   - Test egress validation (response parsing with Zod) on all routes
   - Check error handling and consistent error response formats
   - Test pagination and filtering on list endpoints
   - Validate rate limiting and security middleware

3. **Query Module Performance:**
   - Test pure function query modules for each entity
   - Verify all queries accept `{ plantId, userId, role }` context
   - Check database query performance with EXPLAIN ANALYZE
   - Test transaction support and error handling
   - Validate caching strategies are working
   - Test complex queries and joins perform well

4. **Data Access & Security:**
   - Verify RLS policies work correctly with API queries
   - Test plant-based data isolation through APIs
   - Check that sensitive data is properly filtered based on user roles
   - Validate audit logging is capturing API operations
   - Test that queries are properly parameterized (no SQL injection risks)

5. **API Response Standards:**
   - Verify all list endpoints return `{ data: T[], page, limit, total }` format
   - Check that error responses use shared error taxonomy
   - Test that all responses are properly typed and validated
   - Validate consistent response timing and structure
   - Check API documentation matches actual implementation

**Generate a Safety Training API infrastructure health report with:**
- 🔐 Authentication system status and test results
- 🛣️ API route coverage and functionality (pass/fail per Safety Training endpoint)
- ⚡ Query performance metrics and slow queries
- 🔒 Security validation results (RLS, territory access, etc.)
- 📊 Response format consistency check
- 🚨 Critical issues requiring immediate attention
- ⚠️ Performance bottlenecks or optimization opportunities  
- 📋 Recommendations for API improvements
- 🎯 Backend readiness score for Safety Training frontend development

Include specific API testing commands and examples of fixing common issues.
```

**Expected Output:**
- Complete API infrastructure health assessment
- Authentication and security validation results
- API endpoint functionality matrix
- Query performance analysis
- Security and access control verification

**When to Use This Check-in:**
- After completing steps 10-12 (API infrastructure)
- Before starting frontend component development
- When experiencing API errors or performance issues
- After making changes to authentication or query logic

---

**Next Phase:** If API infrastructure is solid ✅, proceed to `13-component-library.md`
**If Issues:** Fix backend problems before building frontend components